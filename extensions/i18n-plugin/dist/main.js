"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.methods = exports.langJson = exports.curLang = exports.langMap = void 0;
exports.load = load;
exports.unload = unload;
exports.getLangFolderUUID = getLangFolderUUID;
exports.getSelectedLang = getSelectedLang;
exports.checkFolder = checkFolder;
exports.setLang = setLang;
exports.createFolders = createFolders;
// @ts-ignore
const fs_1 = require("fs");
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const package_json_1 = __importDefault(require("../package.json"));
exports.langMap = {};
exports.curLang = "";
exports.langJson = {};
/**
 * @en Registration method for the main process of Extension
 * @zh 为扩展的主进程的注册方法
 */
exports.methods = {
    /**
     * @en A method that can be triggered by message
     * @zh 通过 message 触发的方法
     */
    openPanel() {
        Editor.Panel.open(package_json_1.default.name);
    },
    refreshLang() {
        checkFolder().then(([code, msg]) => {
            setLang(exports.curLang);
        });
    },
    getLangStr(tid) {
        const [id, ...args] = tid.split(",");
        if (exports.langJson == null) {
            return tid;
        }
        let str = exports.langJson[id];
        if (!str) {
            return tid;
        }
        args.forEach((arg, index) => {
            // str = str.replace("${p" + (index + 1) + "}", arg);
            let g = "\\${p" + (index + 1) + "}";
            let reg = new RegExp(g, "g");
            str = str.replace(reg, arg);
        });
        return str;
    },
    async getLangFolderUUID(url = "") {
        return getLangFolderUUID(url);
    },
    async checkFolder(uuid = "") {
        return checkFolder(uuid);
    },
    async setLang(lang) {
        return setLang(lang);
    },
    getLang() {
        return exports.curLang;
    },
    getLangJson() {
        return exports.langJson;
    },
    getCurLang() {
        return exports.curLang;
    },
    getLangMap() {
        return exports.langMap;
    },
    createFolders() {
        return createFolders();
    }
};
/**
 * @en Method Triggered on Extension Startup
 * @zh 扩展启动时触发的方法
 */
async function load() {
    await getSelectedLang();
    const url = await Editor.Profile.getProject('i18n-plugin', 'langFolder');
    if (url == undefined) {
        Editor.Dialog.warn("请先选择语言目录", {
            buttons: ["确定"],
        });
        exports.methods.openPanel();
    }
    else {
        await checkFolder();
        await setLang(exports.curLang);
    }
}
/**
 * @en Method triggered when uninstalling the extension
 * @zh 卸载扩展时触发的方法
 */
function unload() { }
async function getLangFolderUUID(url = "") {
    if (url == "") {
        url = await Editor.Profile.getProject('i18n-plugin', 'langFolder');
    }
    if (url == undefined || url == null || url == "") {
        return "";
    }
    let uuid = await Editor.Message.request('asset-db', 'query-uuid', url);
    if (uuid == null) {
        return "";
    }
    return uuid;
}
async function getSelectedLang() {
    exports.curLang = await Editor.Profile.getProject('i18n-plugin', 'curLang');
}
async function checkFolder(uuid = "") {
    if (uuid == "-1") {
        Editor.Profile.setProject('i18n-plugin', 'langFolder', "");
        return [1, "未获取到 UUID"];
    }
    if (uuid == "") {
        uuid = await getLangFolderUUID();
    }
    if (uuid == "") {
        return [1, "未获取到 UUID"];
    }
    // 获取路径
    const info = await Editor.Message.request('asset-db', 'query-asset-info', uuid);
    if (info == null) {
        console.warn('未获取到路径');
        return [2, "未获取到路径"];
    }
    if (info.isDirectory == false) {
        Editor.Dialog.warn('请选择一个文件夹');
        // await refreshFolder(false);
        return [3, "请选择一个文件夹"];
    }
    const url = info.url;
    exports.langMap = {};
    const folders = await Editor.Message.request('asset-db', 'query-assets', {
        pattern: `${url}/*`
    });
    if (folders.length <= 0) {
        return [4, "未获取到语言包"];
    }
    for (const folder of folders) {
        if (folder.isDirectory) {
            const langCode = folder.name;
            const jsonUrl = `${folder.url}/i18n.json`;
            const jsonUUid = await Editor.Message.request('asset-db', 'query-uuid', jsonUrl);
            if (jsonUUid != null && jsonUUid != undefined && jsonUUid != '') {
                // @ts-ignore
                exports.langMap[langCode] = jsonUrl;
            }
        }
    }
    Editor.Profile.setProject('i18n-plugin', 'langFolder', url);
    if (Object.keys(exports.langMap).length <= 0) {
        return [5, "没有获取到配置"];
    }
    else {
        if (exports.curLang == "" || exports.curLang == undefined) {
            exports.curLang = Object.keys(exports.langMap)[0];
        }
        setLang(exports.curLang);
        return [0, "获取语言包成功"];
    }
}
async function setLang(lang) {
    //@ts-ignore
    const jsonUrl = exports.langMap[lang];
    if (jsonUrl == undefined) {
        return [1, "未获取到语言包"];
    }
    try {
        const nativeUrl = await Editor.Message.request('asset-db', 'query-path', jsonUrl);
        const file = (0, fs_1.readFileSync)(nativeUrl, 'utf-8');
        const json = JSON.parse(file);
        exports.curLang = lang;
        exports.langJson = json;
        await Editor.Message.request('scene', 'soft-reload');
        // 显示 key-value
        const result = Object.entries(json)
            .map(([k, v]) => `${k}: ${v}`)
            .join('<br>');
        return [0, `<b>${lang}</b> 的翻译内容：<br>${result}`];
    }
    catch (e) {
        return [2, `❌ 加载 ${lang} 的 i18n.json 失败`];
    }
}
async function createFolders() {
    const uuids = Editor.Selection.getSelected("asset");
    if (uuids.length <= 0) {
        Editor.Dialog.warn("请先选择一个文件夹", {
            buttons: ["确定"],
        });
        return;
    }
    const uuid = uuids[0];
    const info = await Editor.Message.request('asset-db', 'query-asset-info', uuid);
    if ((info === null || info === void 0 ? void 0 : info.isDirectory) === false) {
        Editor.Dialog.warn("请选择一个文件夹", {
            buttons: ["确定"],
        });
        return;
    }
    // console.log("创建语言包文件夹", info);
    const rootDir = info === null || info === void 0 ? void 0 : info.file;
    // console.log("创建语言包文件夹根目录", rootDir);
    const result = await Editor.Dialog.info("是否在当前目录下\n" + (info === null || info === void 0 ? void 0 : info.name) + "\n创建多语言目录", {
        buttons: ["确定", "取消"],
    });
    if (result.response !== 0)
        return;
    const langs = ['zh'];
    const subDirs = ['font', 'img'];
    for (const lang of langs) {
        // @ts-ignore
        const langPath = (0, path_1.join)(rootDir, 'lang', lang);
        for (const sub of subDirs) {
            const path = (0, path_1.join)(langPath, sub);
            (0, fs_extra_1.ensureDirSync)(path);
            console.log(`创建子目录: ${path}`);
        }
        // 创建 i18n.json
        const i18nPath = (0, path_1.join)(langPath, 'i18n.json');
        console.log(`创建 i18n.json: ${i18nPath}`);
        (0, fs_extra_1.writeJsonSync)(i18nPath, { "TID_TEST1": "测试1" }, { spaces: 2 });
        Editor.Message.request('asset-db', 'refresh-asset', langPath);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NvdXJjZS9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQTBFQSxvQkFhQztBQU1ELHdCQUE0QjtBQUc1Qiw4Q0FZQztBQUVELDBDQUVDO0FBRUQsa0NBMERDO0FBRUQsMEJBdUJDO0FBRUQsc0NBMkNDO0FBbFBELGFBQWE7QUFDYiwyQkFBa0M7QUFDbEMsK0JBQTRCO0FBQzVCLHVDQUF3RDtBQUN4RCxtRUFBMEM7QUFFL0IsUUFBQSxPQUFPLEdBQUcsRUFBRSxDQUFDO0FBQ2IsUUFBQSxPQUFPLEdBQUcsRUFBRSxDQUFDO0FBQ2IsUUFBQSxRQUFRLEdBQThCLEVBQUUsQ0FBQztBQUVwRDs7O0dBR0c7QUFDVSxRQUFBLE9BQU8sR0FBNEM7SUFDNUQ7OztPQUdHO0lBQ0gsU0FBUztRQUNMLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLHNCQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUNELFdBQVc7UUFDUCxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFO1lBQy9CLE9BQU8sQ0FBQyxlQUFPLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxVQUFVLENBQUMsR0FBVztRQUNsQixNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLGdCQUFRLElBQUksSUFBSSxFQUFFLENBQUM7WUFDbkIsT0FBTyxHQUFHLENBQUM7UUFDZixDQUFDO1FBQ0QsSUFBSSxHQUFHLEdBQUcsZ0JBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDUCxPQUFPLEdBQUcsQ0FBQztRQUNmLENBQUM7UUFDRCxJQUFJ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TztJQUNsQyxNQUFNLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JCLE1BQU0sT0FBTyxHQUFHLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWhDLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFLENBQUM7UUFDdkIsYUFBYTtRQUNiLE1BQU0sUUFBUSxHQUFHLElBQUEsV0FBSSxFQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDN0MsS0FBSyxNQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUN4QixNQUFNLElBQUksR0FBRyxJQUFBLFdBQUksRUFBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDakMsSUFBQSx3QkFBYSxFQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2xDLENBQUM7UUFDRCxlQUFlO1FBQ2YsTUFBTSxRQUFRLEdBQUcsSUFBQSxXQUFJLEVBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDekMsSUFBQSx3QkFBYSxFQUFDLFFBQVEsRUFBRSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRS9ELE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbEUsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtaWdub3JlXG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBlbnN1cmVEaXJTeW5jLCB3cml0ZUpzb25TeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IHBhY2thZ2VKU09OIGZyb20gJy4uL3BhY2thZ2UuanNvbic7XG5cbmV4cG9ydCB2YXIgbGFuZ01hcCA9IHt9O1xuZXhwb3J0IHZhciBjdXJMYW5nID0gXCJcIjtcbmV4cG9ydCB2YXIgbGFuZ0pzb246IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcblxuLyoqXG4gKiBAZW4gUmVnaXN0cmF0aW9uIG1ldGhvZCBmb3IgdGhlIG1haW4gcHJvY2VzcyBvZiBFeHRlbnNpb25cbiAqIEB6aCDkuLrmianlsZXnmoTkuLvov5vnqIvnmoTms6jlhozmlrnms5VcbiAqL1xuZXhwb3J0IGNvbnN0IG1ldGhvZHM6IHsgW2tleTogc3RyaW5nXTogKC4uLmFueTogYW55KSA9PiBhbnkgfSA9IHtcbiAgICAvKipcbiAgICAgKiBAZW4gQSBtZXRob2QgdGhhdCBjYW4gYmUgdHJpZ2dlcmVkIGJ5IG1lc3NhZ2VcbiAgICAgKiBAemgg6YCa6L+HIG1lc3NhZ2Ug6Kem5Y+R55qE5pa55rOVXG4gICAgICovXG4gICAgb3BlblBhbmVsKCkge1xuICAgICAgICBFZGl0b3IuUGFuZWwub3BlbihwYWNrYWdlSlNPTi5uYW1lKTtcbiAgICB9LFxuICAgIHJlZnJlc2hMYW5nKCkge1xuICAgICAgICBjaGVja0ZvbGRlcigpLnRoZW4oKFtjb2RlLCBtc2ddKSA9PiB7XG4gICAgICAgICAgICBzZXRMYW5nKGN1ckxhbmcpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGdldExhbmdTdHIodGlkOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgW2lkLCAuLi5hcmdzXSA9IHRpZC5zcGxpdChcIixcIik7XG4gICAgICAgIGlmIChsYW5nSnNvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGlkO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdHIgPSBsYW5nSnNvbltpZF07XG4gICAgICAgIGlmICghc3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGlkO1xuICAgICAgICB9XG4gICAgICAgIGFyZ3MuZm9yRWFjaCgoYXJnOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIC8vIHN0ciA9IHN0ci5yZXBsYWNlKFwiJHtwXCIgKyAoaW5kZXggKyAxKSArIFwifVwiLCBhcmcpO1xuICAgICAgICAgICAgbGV0IGcgPSBcIlxcXFwke3BcIiArIChpbmRleCArIDEpICsgXCJ9XCI7XG4gICAgICAgICAgICBsZXQgcmVnID0gbmV3IFJlZ0V4cChnLCBcImdcIik7XG4gICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZShyZWcsIGFyZyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0TGFuZ0ZvbGRlclVVSUQodXJsOiBzdHJpbmcgPSBcIlwiKSB7XG4gICAgICAgIHJldHVybiBnZXRMYW5nRm9sZGVyVVVJRCh1cmwpO1xuICAgIH0sXG4gICAgYXN5bmMgY2hlY2tGb2xkZXIodXVpZDogc3RyaW5nID0gXCJcIikge1xuICAgICAgICByZXR1cm4gY2hlY2tGb2xkZXIodXVpZCk7XG4gICAgfSxcbiAgICBhc3luYyBzZXRMYW5nKGxhbmc6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gc2V0TGFuZyhsYW5nKTtcbiAgICB9LFxuICAgIGdldExhbmcoKSB7XG4gICAgICAgIHJldHVybiBjdXJMYW5nO1xuICAgIH0sXG4gICAgZ2V0TGFuZ0pzb24oKSB7XG4gICAgICAgIHJldHVybiBsYW5nSnNvbjtcbiAgICB9LFxuICAgIGdldEN1ckxhbmcoKSB7XG4gICAgICAgIHJldHVybiBjdXJMYW5nO1xuICAgIH0sXG4gICAgZ2V0TGFuZ01hcCgpIHtcbiAgICAgICAgcmV0dXJuIGxhbmdNYXA7XG4gICAgfSxcbiAgICBjcmVhdGVGb2xkZXJzKCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlRm9sZGVycygpO1xuICAgIH1cbn07XG5cbi8qKlxuICogQGVuIE1ldGhvZCBUcmlnZ2VyZWQgb24gRXh0ZW5zaW9uIFN0YXJ0dXBcbiAqIEB6aCDmianlsZXlkK/liqjml7bop6blj5HnmoTmlrnms5VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWQoKSB7XG4gICAgYXdhaXQgZ2V0U2VsZWN0ZWRMYW5nKCk7XG4gICAgY29uc3QgdXJsID0gYXdhaXQgRWRpdG9yLlByb2ZpbGUuZ2V0UHJvamVjdCgnaTE4bi1wbHVnaW4nLCAnbGFuZ0ZvbGRlcicpO1xuICAgIGlmICh1cmwgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIEVkaXRvci5EaWFsb2cud2FybihcIuivt+WFiOmAieaLqeivreiogOebruW9lVwiLCB7XG4gICAgICAgICAgICBidXR0b25zOiBbXCLnoa7lrppcIl0sXG4gICAgICAgIH0pO1xuICAgICAgICBtZXRob2RzLm9wZW5QYW5lbCgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXdhaXQgY2hlY2tGb2xkZXIoKTtcbiAgICAgICAgYXdhaXQgc2V0TGFuZyhjdXJMYW5nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGVuIE1ldGhvZCB0cmlnZ2VyZWQgd2hlbiB1bmluc3RhbGxpbmcgdGhlIGV4dGVuc2lvblxuICogQHpoIOWNuOi9veaJqeWxleaXtuinpuWPkeeahOaWueazlVxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5sb2FkKCkgeyB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldExhbmdGb2xkZXJVVUlEKHVybDogc3RyaW5nID0gXCJcIik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKHVybCA9PSBcIlwiKSB7XG4gICAgICAgIHVybCA9IGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldFByb2plY3QoJ2kxOG4tcGx1Z2luJywgJ2xhbmdGb2xkZXInKTtcbiAgICB9XG4gICAgaWYgKHVybCA9PSB1bmRlZmluZWQgfHwgdXJsID09IG51bGwgfHwgdXJsID09IFwiXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIGxldCB1dWlkID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncXVlcnktdXVpZCcsIHVybCBhcyBhbnkpO1xuICAgIGlmICh1dWlkID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIHJldHVybiB1dWlkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0ZWRMYW5nKCkge1xuICAgIGN1ckxhbmcgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRQcm9qZWN0KCdpMThuLXBsdWdpbicsICdjdXJMYW5nJyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0ZvbGRlcih1dWlkOiBzdHJpbmcgPSBcIlwiKTogUHJvbWlzZTxbbnVtYmVyLCBzdHJpbmddPiB7XG4gICAgaWYgKHV1aWQgPT0gXCItMVwiKSB7XG4gICAgICAgIEVkaXRvci5Qcm9maWxlLnNldFByb2plY3QoJ2kxOG4tcGx1Z2luJywgJ2xhbmdGb2xkZXInLCBcIlwiKTtcbiAgICAgICAgcmV0dXJuIFsxLCBcIuacquiOt+WPluWIsCBVVUlEXCJdO1xuICAgIH1cblxuICAgIGlmICh1dWlkID09IFwiXCIpIHtcbiAgICAgICAgdXVpZCA9IGF3YWl0IGdldExhbmdGb2xkZXJVVUlEKCk7XG4gICAgfVxuICAgIGlmICh1dWlkID09IFwiXCIpIHtcbiAgICAgICAgcmV0dXJuIFsxLCBcIuacquiOt+WPluWIsCBVVUlEXCJdO1xuICAgIH1cblxuICAgIC8vIOiOt+WPlui3r+W+hFxuICAgIGNvbnN0IGluZm8gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdxdWVyeS1hc3NldC1pbmZvJywgdXVpZCk7XG4gICAgaWYgKGluZm8gPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ+acquiOt+WPluWIsOi3r+W+hCcpO1xuICAgICAgICByZXR1cm4gWzIsIFwi5pyq6I635Y+W5Yiw6Lev5b6EXCJdO1xuICAgIH1cblxuICAgIGlmIChpbmZvLmlzRGlyZWN0b3J5ID09IGZhbHNlKSB7XG4gICAgICAgIEVkaXRvci5EaWFsb2cud2Fybign6K+36YCJ5oup5LiA5Liq5paH5Lu25aS5Jyk7XG4gICAgICAgIC8vIGF3YWl0IHJlZnJlc2hGb2xkZXIoZmFsc2UpO1xuICAgICAgICByZXR1cm4gWzMsIFwi6K+36YCJ5oup5LiA5Liq5paH5Lu25aS5XCJdO1xuICAgIH1cblxuICAgIGNvbnN0IHVybCA9IGluZm8udXJsO1xuICAgIGxhbmdNYXAgPSB7fTtcbiAgICBjb25zdCBmb2xkZXJzID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncXVlcnktYXNzZXRzJywge1xuICAgICAgICBwYXR0ZXJuOiBgJHt1cmx9LypgXG4gICAgfSk7XG4gICAgaWYgKGZvbGRlcnMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgcmV0dXJuIFs0LCBcIuacquiOt+WPluWIsOivreiogOWMhVwiXTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBmb2xkZXJzKSB7XG4gICAgICAgIGlmIChmb2xkZXIuaXNEaXJlY3RvcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhbmdDb2RlID0gZm9sZGVyLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBqc29uVXJsID0gYCR7Zm9sZGVyLnVybH0vaTE4bi5qc29uYDtcbiAgICAgICAgICAgIGNvbnN0IGpzb25VVWlkID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncXVlcnktdXVpZCcsIGpzb25VcmwpO1xuICAgICAgICAgICAgaWYgKGpzb25VVWlkICE9IG51bGwgJiYganNvblVVaWQgIT0gdW5kZWZpbmVkICYmIGpzb25VVWlkICE9ICcnKSB7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGxhbmdNYXBbbGFuZ0NvZGVdID0ganNvblVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBFZGl0b3IuUHJvZmlsZS5zZXRQcm9qZWN0KCdpMThuLXBsdWdpbicsICdsYW5nRm9sZGVyJywgdXJsKTtcblxuICAgIGlmIChPYmplY3Qua2V5cyhsYW5nTWFwKS5sZW5ndGggPD0gMCkge1xuICAgICAgICByZXR1cm4gWzUsIFwi5rKh5pyJ6I635Y+W5Yiw6YWN572uXCJdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGN1ckxhbmcgPT0gXCJcIiB8fCBjdXJMYW5nID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY3VyTGFuZyA9IE9iamVjdC5rZXlzKGxhbmdNYXApWzBdO1xuICAgICAgICB9XG4gICAgICAgIHNldExhbmcoY3VyTGFuZyk7XG4gICAgICAgIHJldHVybiBbMCwgXCLojrflj5bor63oqIDljIXmiJDlip9cIl07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0TGFuZyhsYW5nOiBzdHJpbmcpOiBQcm9taXNlPFtudW1iZXIsIHN0cmluZ10+IHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICBjb25zdCBqc29uVXJsID0gbGFuZ01hcFtsYW5nXTtcbiAgICBpZiAoanNvblVybCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIFsxLCBcIuacquiOt+WPluWIsOivreiogOWMhVwiXTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmF0aXZlVXJsID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncXVlcnktcGF0aCcsIGpzb25VcmwpO1xuICAgICAgICBjb25zdCBmaWxlID0gcmVhZEZpbGVTeW5jKG5hdGl2ZVVybCBhcyBhbnksICd1dGYtOCcpO1xuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShmaWxlKTtcblxuICAgICAgICBjdXJMYW5nID0gbGFuZztcbiAgICAgICAgbGFuZ0pzb24gPSBqc29uO1xuICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdzb2Z0LXJlbG9hZCcpO1xuICAgICAgICAvLyDmmL7npLoga2V5LXZhbHVlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IE9iamVjdC5lbnRyaWVzKGpzb24pXG4gICAgICAgICAgICAubWFwKChbaywgdl0pID0+IGAke2t9OiAke3Z9YClcbiAgICAgICAgICAgIC5qb2luKCc8YnI+Jyk7XG5cbiAgICAgICAgcmV0dXJuIFswLCBgPGI+JHtsYW5nfTwvYj4g55qE57+76K+R5YaF5a6577yaPGJyPiR7cmVzdWx0fWBdO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIFsyLCBg4p2MIOWKoOi9vSAke2xhbmd9IOeahCBpMThuLmpzb24g5aSx6LSlYF07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlRm9sZGVycygpIHtcbiAgICBjb25zdCB1dWlkcyA9IEVkaXRvci5TZWxlY3Rpb24uZ2V0U2VsZWN0ZWQoXCJhc3NldFwiKTtcbiAgICBpZiAodXVpZHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgRWRpdG9yLkRpYWxvZy53YXJuKFwi6K+35YWI6YCJ5oup5LiA5Liq5paH5Lu25aS5XCIsIHtcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcIuehruWumlwiXSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXVpZCA9IHV1aWRzWzBdO1xuICAgIGNvbnN0IGluZm8gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdxdWVyeS1hc3NldC1pbmZvJywgdXVpZCk7XG4gICAgaWYgKGluZm8/LmlzRGlyZWN0b3J5ID09PSBmYWxzZSkge1xuICAgICAgICBFZGl0b3IuRGlhbG9nLndhcm4oXCLor7fpgInmi6nkuIDkuKrmlofku7blpLlcIiwge1xuICAgICAgICAgICAgYnV0dG9uczogW1wi56Gu5a6aXCJdLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhcIuWIm+W7uuivreiogOWMheaWh+S7tuWkuVwiLCBpbmZvKTtcbiAgICBjb25zdCByb290RGlyID0gaW5mbz8uZmlsZTtcbiAgICAvLyBjb25zb2xlLmxvZyhcIuWIm+W7uuivreiogOWMheaWh+S7tuWkueagueebruW9lVwiLCByb290RGlyKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEVkaXRvci5EaWFsb2cuaW5mbyhcIuaYr+WQpuWcqOW9k+WJjeebruW9leS4i1xcblwiICsgaW5mbz8ubmFtZSArIFwiXFxu5Yib5bu65aSa6K+t6KiA55uu5b2VXCIsIHtcbiAgICAgICAgYnV0dG9uczogW1wi56Gu5a6aXCIsIFwi5Y+W5raIXCJdLFxuICAgIH0pO1xuXG4gICAgaWYgKHJlc3VsdC5yZXNwb25zZSAhPT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IGxhbmdzID0gWyd6aCddO1xuICAgIGNvbnN0IHN1YkRpcnMgPSBbJ2ZvbnQnLCAnaW1nJ107XG5cbiAgICBmb3IgKGNvbnN0IGxhbmcgb2YgbGFuZ3MpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBsYW5nUGF0aCA9IGpvaW4ocm9vdERpciwgJ2xhbmcnLCBsYW5nKTtcbiAgICAgICAgZm9yIChjb25zdCBzdWIgb2Ygc3ViRGlycykge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGpvaW4obGFuZ1BhdGgsIHN1Yik7XG4gICAgICAgICAgICBlbnN1cmVEaXJTeW5jKHBhdGgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYOWIm+W7uuWtkOebruW9lTogJHtwYXRofWApO1xuICAgICAgICB9XG4gICAgICAgIC8vIOWIm+W7uiBpMThuLmpzb25cbiAgICAgICAgY29uc3QgaTE4blBhdGggPSBqb2luKGxhbmdQYXRoLCAnaTE4bi5qc29uJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKGDliJvlu7ogaTE4bi5qc29uOiAke2kxOG5QYXRofWApO1xuICAgICAgICB3cml0ZUpzb25TeW5jKGkxOG5QYXRoLCB7IFwiVElEX1RFU1QxXCI6IFwi5rWL6K+VMVwiIH0sIHsgc3BhY2VzOiAyIH0pO1xuXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ3JlZnJlc2gtYXNzZXQnLCBsYW5nUGF0aCk7XG4gICAgfVxufVxuIl19