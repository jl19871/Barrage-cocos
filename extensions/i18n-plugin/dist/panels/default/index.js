"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/*
 * @Author: JL
 * @Date: 2025-05-21 20:24:18
 */
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
/**
 * @zh 如果希望兼容 3.3 之前的版本可以使用下方的代码
 * @en You can add the code below if you want compatibility with versions prior to 3.3
 */
// Editor.Panel.define = Editor.Panel.define || function(options: any) { return options }
module.exports = Editor.Panel.define({
    listeners: {
        show() { console.log('show'); },
        hide() { console.log('hide'); },
    },
    template: (0, fs_extra_1.readFileSync)((0, path_1.join)(__dirname, '../../../static/settings/settings.html'), 'utf-8'),
    style: (0, fs_extra_1.readFileSync)((0, path_1.join)(__dirname, '../../../static/settings/settings.css'), 'utf-8'),
    $: {
        app: '#app',
        langFolder: '#langFolder',
        langSelect: '#langSelect',
        langSelectWrap: '#langSelectWrap',
        refreshBtn: '#refreshBtn',
    },
    methods: {
        hello() {
            if (this.$.app) {
                this.$.app.innerHTML = 'hello';
                console.log('[cocos-panel-html.default]: hello');
            }
        },
        async refreshFolder(needCheck = true) {
            if (this.$.langFolder) {
                const uuid = await Editor.Message.request("i18n-plugin", "getLangFolderUUID");
                if (uuid != "") {
                    // @ts-ignore
                    this.$.langFolder.value = uuid;
                    await this.checkFolder(uuid);
                }
                else {
                    // @ts-ignore
                    this.$.langFolder.value = null;
                    // @ts-ignore
                    this.$.langSelectWrap.style.display = 'none';
                    // @ts-ignore
                    this.$.refreshBtn.style.display = 'none';
                }
            }
        },
        async checkFolder(uuid = "") {
            const [code, msg] = await Editor.Message.request('i18n-plugin', 'checkFolder', uuid);
            // @ts-ignore
            this.$.app.innerHTML = msg;
            switch (code) {
                case 0:
                    {
                        const langJson = await Editor.Message.request('i18n-plugin', 'getLangJson');
                        const curLang = await Editor.Message.request('i18n-plugin', 'getCurLang');
                        const langMap = await Editor.Message.request('i18n-plugin', 'getLangMap');
                        // @ts-ignore
                        this.$.langSelectWrap.style.display = '';
                        // @ts-ignore
                        this.$.refreshBtn.style.display = '';
                        // 更新下拉选项
                        const select = this.$.langSelect;
                        // @ts-ignore
                        select.innerHTML = ''; // 清空旧选项
                        Object.keys(langMap).forEach(code => {
                            const opt = document.createElement('option');
                            opt.value = code;
                            opt.innerText = code.toUpperCase();
                            // @ts-ignore
                            select.appendChild(opt);
                        });
                        // @ts-ignore
                        select.value = curLang;
                        this.setLang(curLang);
                    }
                    break;
                case 1:
                    {
                        Editor.Profile.setProject('i18n-plugin', 'langFolder', "");
                        // @ts-ignore
                        this.$.langSelectWrap.style.display = 'none';
                        // @ts-ignore
                        this.$.refreshBtn.style.display = 'none';
                    }
                    break;
                case 3:
                    {
                        await this.refreshFolder(false);
                    }
                    break;
                case 5:
                    {
                        // @ts-ignore
                        this.$.langSelectWrap.style.display = 'none';
                        // @ts-ignore
                        this.$.refreshBtn.style.display = 'none';
                    }
                    break;
            }
        },
        async setLang(lang) {
            var _a;
            const [code, msg] = await Editor.Message.request('i18n-plugin', 'setLang', lang);
            // @ts-ignore
            (_a = this.$.app) === null || _a === void 0 ? void 0 : _a.innerHTML = msg;
        }
    },
    async ready() {
        console.log('ready');
        if (this.$.app) {
            this.$.app.innerHTML = '';
        }
        if (this.$.refreshBtn) {
            this.$.refreshBtn.addEventListener('confirm', async () => {
                await this.refreshFolder();
            });
        }
        if (this.$.langFolder) {
            this.refreshFolder();
            //@ts-ignore
            if (this.$.langFolder.value != null) {
                const curLang = await Editor.Message.request('i18n-plugin', 'getCurLang');
                // @ts-ignore
                this.$.langSelect.value = curLang;
                if (curLang != null) {
                    // @ts-ignore
                    this.setLang(curLang);
                }
            }
            this.$.langFolder.addEventListener('confirm', async (event) => {
                //@ts-ignore
                let uuid = this.$.langFolder.value;
                if (uuid == null || uuid == undefined || uuid == '') {
                    uuid = "-1";
                }
                this.checkFolder(uuid);
            });
            //@ts-ignore
            this.$.langSelect.addEventListener('confirm', async () => {
                //@ts-ignore
                const lang = this.$.langSelect.value;
                this.setLang(lang);
            });
        }
    },
    beforeClose() { },
    close() { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvcGFuZWxzL2RlZmF1bHQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7O0dBR0c7QUFDSCx1Q0FBd0M7QUFDeEMsK0JBQTRCO0FBQzVCOzs7R0FHRztBQUNILHlGQUF5RjtBQUN6RixNQUFNLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQ2pDLFNBQVMsRUFBRTtRQUNQLElBQUksS0FBSyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQixJQUFJLEtBQUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDbEM7SUFDRCxRQUFRLEVBQUUsSUFBQSx1QkFBWSxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSx3Q0FBd0MsQ0FBQyxFQUFFLE9BQU8sQ0FBQztJQUMxRixLQUFLLEVBQUUsSUFBQSx1QkFBWSxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSx1Q0FBdUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQztJQUN0RixDQUFDLEVBQUU7UUFDQyxHQUFHLEVBQUUsTUFBTTtRQUNYLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLGNBQWMsRUFBRSxpQkFBaUI7UUFDakMsVUFBVSxFQUFFLGFBQWE7S0FDNUI7SUFDRCxPQUFPLEVBQUU7UUFDTCxLQUFLO1lBQ0QsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNiLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7Z0JBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUNBQW1DLENBQUMsQ0FBQztZQUNyRCxDQUFDO1FBQ0wsQ0FBQztRQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsU0FB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SSxHQUFHLElBQUksQ0FBQztnQkFDaEIsQ0FBQztnQkFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDO1lBRUgsWUFBWTtZQUNaLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDckQsWUFBWTtnQkFDWixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUM7Z0JBQ3JDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkIsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDO0lBQ0wsQ0FBQztJQUNELFdBQVcsS0FBSyxDQUFDO0lBQ2pCLEtBQUssS0FBSyxDQUFDO0NBQ2QsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBBdXRob3I6IEpMXG4gKiBARGF0ZTogMjAyNS0wNS0yMSAyMDoyNDoxOFxuICovXG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG4vKipcbiAqIEB6aCDlpoLmnpzluIzmnJvlhbzlrrkgMy4zIOS5i+WJjeeahOeJiOacrOWPr+S7peS9v+eUqOS4i+aWueeahOS7o+eggVxuICogQGVuIFlvdSBjYW4gYWRkIHRoZSBjb2RlIGJlbG93IGlmIHlvdSB3YW50IGNvbXBhdGliaWxpdHkgd2l0aCB2ZXJzaW9ucyBwcmlvciB0byAzLjNcbiAqL1xuLy8gRWRpdG9yLlBhbmVsLmRlZmluZSA9IEVkaXRvci5QYW5lbC5kZWZpbmUgfHwgZnVuY3Rpb24ob3B0aW9uczogYW55KSB7IHJldHVybiBvcHRpb25zIH1cbm1vZHVsZS5leHBvcnRzID0gRWRpdG9yLlBhbmVsLmRlZmluZSh7XG4gICAgbGlzdGVuZXJzOiB7XG4gICAgICAgIHNob3coKSB7IGNvbnNvbGUubG9nKCdzaG93Jyk7IH0sXG4gICAgICAgIGhpZGUoKSB7IGNvbnNvbGUubG9nKCdoaWRlJyk7IH0sXG4gICAgfSxcbiAgICB0ZW1wbGF0ZTogcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vc3RhdGljL3NldHRpbmdzL3NldHRpbmdzLmh0bWwnKSwgJ3V0Zi04JyksXG4gICAgc3R5bGU6IHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL3N0YXRpYy9zZXR0aW5ncy9zZXR0aW5ncy5jc3MnKSwgJ3V0Zi04JyksXG4gICAgJDoge1xuICAgICAgICBhcHA6ICcjYXBwJyxcbiAgICAgICAgbGFuZ0ZvbGRlcjogJyNsYW5nRm9sZGVyJyxcbiAgICAgICAgbGFuZ1NlbGVjdDogJyNsYW5nU2VsZWN0JyxcbiAgICAgICAgbGFuZ1NlbGVjdFdyYXA6ICcjbGFuZ1NlbGVjdFdyYXAnLFxuICAgICAgICByZWZyZXNoQnRuOiAnI3JlZnJlc2hCdG4nLFxuICAgIH0sXG4gICAgbWV0aG9kczoge1xuICAgICAgICBoZWxsbygpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiQuYXBwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kLmFwcC5pbm5lckhUTUwgPSAnaGVsbG8nO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbY29jb3MtcGFuZWwtaHRtbC5kZWZhdWx0XTogaGVsbG8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhc3luYyByZWZyZXNoRm9sZGVyKG5lZWRDaGVjayA9IHRydWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiQubGFuZ0ZvbGRlcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHV1aWQgPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KFwiaTE4bi1wbHVnaW5cIiwgXCJnZXRMYW5nRm9sZGVyVVVJRFwiKTtcbiAgICAgICAgICAgICAgICBpZiAodXVpZCAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kLmxhbmdGb2xkZXIudmFsdWUgPSB1dWlkO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNoZWNrRm9sZGVyKHV1aWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiQubGFuZ0ZvbGRlci52YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kLmxhbmdTZWxlY3RXcmFwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kLnJlZnJlc2hCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXN5bmMgY2hlY2tGb2xkZXIodXVpZDogc3RyaW5nID0gXCJcIikge1xuICAgICAgICAgICAgY29uc3QgW2NvZGUsIG1zZ10gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdpMThuLXBsdWdpbicsICdjaGVja0ZvbGRlcicsIHV1aWQpO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgdGhpcy4kLmFwcC5pbm5lckhUTUwgPSBtc2c7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhbmdKc29uID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnaTE4bi1wbHVnaW4nLCAnZ2V0TGFuZ0pzb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1ckxhbmcgPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdpMThuLXBsdWdpbicsICdnZXRDdXJMYW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYW5nTWFwID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnaTE4bi1wbHVnaW4nLCAnZ2V0TGFuZ01hcCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQubGFuZ1NlbGVjdFdyYXAuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kLnJlZnJlc2hCdG4uc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw5LiL5ouJ6YCJ6aG5XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3QgPSB0aGlzLiQubGFuZ1NlbGVjdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdC5pbm5lckhUTUwgPSAnJzsgLy8g5riF56m65pen6YCJ6aG5XG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhsYW5nTWFwKS5mb3JFYWNoKGNvZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdC52YWx1ZSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0LmlubmVyVGV4dCA9IGNvZGUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdC52YWx1ZSA9IGN1ckxhbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldExhbmcoY3VyTGFuZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBFZGl0b3IuUHJvZmlsZS5zZXRQcm9qZWN0KCdpMThuLXBsdWdpbicsICdsYW5nRm9sZGVyJywgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQubGFuZ1NlbGVjdFdyYXAuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJC5yZWZyZXNoQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2hGb2xkZXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kLmxhbmdTZWxlY3RXcmFwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQucmVmcmVzaEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXN5bmMgc2V0TGFuZyhsYW5nOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IFtjb2RlLCBtc2ddID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnaTE4bi1wbHVnaW4nLCAnc2V0TGFuZycsIGxhbmcpO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgdGhpcy4kLmFwcD8uaW5uZXJIVE1MID0gbXNnO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhc3luYyByZWFkeSgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlYWR5Jyk7XG4gICAgICAgIGlmICh0aGlzLiQuYXBwKSB7XG4gICAgICAgICAgICB0aGlzLiQuYXBwLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiQucmVmcmVzaEJ0bikge1xuICAgICAgICAgICAgdGhpcy4kLnJlZnJlc2hCdG4uYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2hGb2xkZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuJC5sYW5nRm9sZGVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hGb2xkZXIoKTtcblxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgICAgICBpZiAodGhpcy4kLmxhbmdGb2xkZXIudmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1ckxhbmcgPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdpMThuLXBsdWdpbicsICdnZXRDdXJMYW5nJyk7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIHRoaXMuJC5sYW5nU2VsZWN0LnZhbHVlID0gY3VyTGFuZztcbiAgICAgICAgICAgICAgICBpZiAoY3VyTGFuZyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMYW5nKGN1ckxhbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy4kLmxhbmdGb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGxldCB1dWlkID0gdGhpcy4kLmxhbmdGb2xkZXIudmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHV1aWQgPT0gbnVsbCB8fCB1dWlkID09IHVuZGVmaW5lZCB8fCB1dWlkID09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHV1aWQgPSBcIi0xXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tGb2xkZXIodXVpZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgICAgICB0aGlzLiQubGFuZ1NlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGNvbnN0IGxhbmcgPSB0aGlzLiQubGFuZ1NlbGVjdC52YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldExhbmcobGFuZyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYmVmb3JlQ2xvc2UoKSB7IH0sXG4gICAgY2xvc2UoKSB7IH0sXG59KTtcbiJdfQ==